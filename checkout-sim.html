<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Checkout (Simulation) — Roll'N'Deal</title>
  <link rel='stylesheet' href='style.css'>
  <style>
    .container{max-width:1000px;margin:24px auto;padding:0 16px}
    .checkout-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    .card{background:#151515;border:1px solid #2a2a2a;border-radius:14px;padding:18px}
    .card h3{margin:0 0 12px}
    .row{display:flex;gap:12px}
    .row .col{flex:1}
    .label{display:block;font-weight:600;margin:12px 0 6px}
    input, select{width:100%;padding:10px;border-radius:8px;border:1px solid #3a3a3a;background:#0f0f0f;color:#ddd}
    .shipping-options{display:flex;flex-direction:column;gap:8px;margin-top:6px}
    .summary{font-size:0.95rem}
    .summary .line{display:flex;justify-content:space-between;margin:6px 0}
    .total{font-size:1.2rem;font-weight:700;color:#19ff88}
    .actions{margin-top:14px;display:flex;gap:12px}
    .cta{background:#19ff88;color:#0b0b0b;border:none;padding:12px 20px;border-radius:10px;cursor:pointer;box-shadow:0 0 12px rgba(25,255,136,.35)}
    .muted{color:#999;font-size:.85rem}
    @media (max-width:860px){.checkout-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class='container'>
    <h1>Checkout (Simulation)</h1>
    <p class='muted'>此页为模拟结账：收件信息、运费选项与订单确认。用于演示体验，不会真实扣款。</p>

    <div class='checkout-grid'>
      <div class='card'>
        <h3>Shipping Details</h3>
        <div class='row'>
          <div class='col'>
            <label class='label'>Full Name</label>
            <input id='name' placeholder='Your name'>
          </div>
          <div class='col'>
            <label class='label'>Email</label>
            <input id='email' type='email' placeholder='you@example.com'>
          </div>
        </div>
        <div class='row'>
          <div class='col'>
            <label class='label'>Phone</label>
            <input id='phone' placeholder='+1 555-555-5555'>
          </div>
          <div class='col'>
            <label class='label'>Country</label>
            <select id='country'>
              <option value='US' selected>United States</option>
              <option value='CA'>Canada</option>
            </select>
          </div>
        </div>
        <label class='label'>Address line 1</label>
        <input id='addr1' placeholder='Street address'>
        <label class='label'>Address line 2</label>
        <input id='addr2' placeholder='Apt, suite, etc. (optional)'>
        <div class='row'>
          <div class='col'>
            <label class='label'>City</label>
            <input id='city'>
          </div>
          <div class='col'>
            <label class='label'>State/Province</label>
            <input id='state' placeholder='e.g., MA'>
          </div>
          <div class='col'>
            <label class='label'>ZIP/Postal code</label>
            <input id='zip'>
          </div>
        </div>

        <h3 style='margin-top:16px'>Shipping Options</h3>
        <div class='shipping-options'>
          <label><input type='radio' name='ship' value='standard' checked> Standard — $9.99，5–7 business days</label>
          <label><input type='radio' name='ship' value='express'> Express — $24.99，1–2 business days</label>
          <label id='freeOpt' style='display:none'><input type='radio' name='ship' value='free'> Free — 满 $99 自动免邮</label>
        </div>
        <p class='muted'>如果满足满额免邮，我们会自动显示 Free 选项。</p>
      </div>

      <div class='card summary'>
        <h3>Order Summary</h3>
        <div id='items'></div>
        <div class='line'><span>Subtotal</span><span id='subtotal'>$0.00</span></div>
        <div class='line'><span>Shipping</span><span id='shipCost'>$0.00</span></div>
        <div class='line'><span>Estimated Tax</span><span id='tax'>$0.00</span></div>
        <div class='line total'><span>Total</span><span id='total'>$0.00</span></div>
        <div class='actions'>
          <button id='placeOrder' class='cta'>Place Order (Simulated)</button>
          <button onclick="window.location.href='index.html'" class='cta' style='background:#ffcc00;color:#111'>Back</button>
        </div>
        <p id='ok' class='muted' style='margin-top:10px;display:none'>✅ 已确认（模拟）。你可以继续完成真实支付或返回修改。</p>
      </div>
    </div>
  </div>

  <script>
    const PRICES_USD = { classic: 3999, pro: 5999, xl: 7999, neon: 9999 };
    function getCart(){ try{ return JSON.parse(localStorage.getItem('rnd_cart')||'[]'); }catch(e){ return []; } }
    function fmtCents(c){ return `$${(c/100).toFixed(2)}`; }
    function subtotalCents(){ return getCart().reduce((s,it)=> s + (PRICES_USD[it.sku]||0)*(it.qty||it.quantity||1), 0); }
    function taxRate(country, state){ if(country==='US' && state && state.toUpperCase()==='MA') return 0.0625; return 0.05; }

    function render(){
      const cart = getCart();
      const box = document.getElementById('items');
      box.innerHTML = cart.map(it=>{
        const price = PRICES_USD[it.sku]||0; const qty = it.qty||it.quantity||1;
        return `<div class='line'><span>${it.sku} — ${it.color||'—'} × ${qty}</span><span>${fmtCents(price*qty)}</span></div>`;
      }).join('') || '<p class='muted'>Cart is empty</p>';

      const sub = subtotalCents();
      document.getElementById('subtotal').textContent = fmtCents(sub);

      // free shipping eligibility
      const freeEligible = sub >= 9900;
      const freeRow = document.getElementById('freeOpt');
      if(freeRow) freeRow.style.display = freeEligible ? 'block' : 'none';

      const shipSel = document.querySelector('input[name=ship]:checked');
      let ship = 0;
      if(shipSel){ ship = shipSel.value==='express' ? 2499 : (shipSel.value==='free' ? 0 : 999); }
      document.getElementById('shipCost').textContent = fmtCents(ship);

      const country = document.getElementById('country').value;
      const state = document.getElementById('state').value;
      const tax = Math.round((sub+ship) * taxRate(country, state));
      document.getElementById('tax').textContent = fmtCents(tax);
      document.getElementById('total').textContent = fmtCents(sub + ship + tax);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      render();
      document.querySelectorAll('input, select').forEach(el=> el.addEventListener('input', render));
      document.querySelectorAll('input[name=ship]').forEach(el=> el.addEventListener('change', render));
      document.getElementById('placeOrder').addEventListener('click', ()=>{
        const payload = {
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          phone: document.getElementById('phone').value,
          country: document.getElementById('country').value,
          addr1: document.getElementById('addr1').value,
          addr2: document.getElementById('addr2').value,
          city: document.getElementById('city').value,
          state: document.getElementById('state').value,
          zip: document.getElementById('zip').value,
          ship: document.querySelector('input[name=ship]:checked')?.value,
          cart: getCart(),
          totals: {
            subtotal: document.getElementById('subtotal').textContent,
            shipping: document.getElementById('shipCost').textContent,
            tax: document.getElementById('tax').textContent,
            total: document.getElementById('total').textContent,
          }
        };
        localStorage.setItem('rnd_last_order', JSON.stringify(payload));
        document.getElementById('ok').style.display='block';
      });
    });
  </script>
</body>
</html>
